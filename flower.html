<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <title>3D Rose</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background-color: #f5e6d3;  /*温暖的背景色*/
        }
        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            z-index: 1;
        }
        .valueDisplay {
            display: none;  /*隐藏所有滑块*/
        }
        .Slider {
            display: none;  /*隐藏所有滑块*/
        }
        #textDisplay {
            position: absolute;
            top: 20px;
            width: 100%;
            text-align: center;
            font-family: 'Brush Script MT', 'Playfair Display', Arial, sans-serif;
            font-size: 32px;
            color: #6b3e30;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
            user-select: none;
        }
    </style>
</head>
<body>
    <div id="textDisplay">小希妹妹幸福相伴</div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
    <script>
        let v = [];
        let cols = 600, rows = 30;
        let t_D = 180 * 15 / cols;
        let r_D = 1 / rows;
        let targetOpening = 0;
        let isBlooming = true;

        let opening, vDensity, pAlign, curve1, curve2;
        let opening_, vDensity_, pAlign_, curve1_, curve2_;
        let canvas;

        function setup() {
            canvas = createCanvas(windowWidth, windowHeight, WEBGL);
            canvas.id('canvas');

            colorMode(HSB);
            angleMode(DEGREES);
            noStroke();

            // Create text display
            createTextDisplay();

            // Initialize sliders (hidden)
            opening_ = createDiv();
            opening_.class('valueDisplay');
            opening = createSlider(1, 10, 0, 0.1);
            opening.class('Slider');

            vDensity_ = createDiv();
            vDensity_.class('valueDisplay');
            vDensity = createSlider(1, 20, 8, 0.1);
            vDensity.class('Slider');

            pAlign_ = createDiv();
            pAlign_.class('valueDisplay');
            pAlign = createSlider(0, 6, 3.6, 0.05);
            pAlign.class('Slider');

            curve1_ = createDiv();
            curve1_.class('valueDisplay');
            curve1 = createSlider(-6, 6, 2, 0.1);
            curve1.class('Slider');

            curve2_ = createDiv();
            curve2_.class('valueDisplay');
            curve2 = createSlider(0.5, 1.5, 1.3, 0.1);
            curve2.class('Slider');

            frameRate(30);
        }

        function createTextDisplay() {
            const textDisplay = createDiv('小希妹妹幸福相伴');
            textDisplay.id('textDisplay');
            textDisplay.style('font-size', '32px');
            textDisplay.style('font-family', "'Brush Script MT', 'Playfair Display', Arial, sans-serif");
            textDisplay.style('color', '#6b3e30');
            textDisplay.style('position', 'absolute');
            textDisplay.style('top', '20px');
            textDisplay.style('width', '100%');
            textDisplay.style('text-align', 'center');
            textDisplay.style('text-shadow', '2px 2px 4px rgba(0,0,0,0.2)');
        }

        function draw() {
            clear();
            orbitControl(4, 4);
            rotateX(-30);

            // Animate opening with bloom/wilt effect
            if (isBlooming) {
                targetOpening = min(targetOpening + 0.02, 10);
                if (targetOpening >= 10) {
                    isBlooming = false;
                }
            } else {
                targetOpening = max(targetOpening - 0.02, 0);
                if (targetOpening <= 0) {
                    isBlooming = true;
                }
            }
            opening.value(targetOpening);

            for (let r = 0; r <= rows; r++) {
                v.push([]);
                for (let theta = 0; theta <= cols; theta++) {
                    let phi = (180 / opening.value()) * Math.exp(-theta * t_D / (vDensity.value() * 180));
                    let petalCut = 1 - (1 / 2) * pow((5 / 4) * pow(1 - ((pAlign.value() * theta * t_D % 360) / 180), 2) - 1 / 4, 2);
                    let hangDown = curve1.value() * pow(r * r_D, 2) * pow(curve2.value() * r * r_D - 1, 2) * sin(phi);

                    let pX = 260 * petalCut * (r * r_D * sin(phi) + hangDown * cos(phi)) * sin(theta * t_D);
                    let pY = -260 * petalCut * (r * r_D * cos(phi) - hangDown * sin(phi));
                    let pZ = 260 * petalCut * (r * r_D * sin(phi) + hangDown * cos(phi)) * cos(theta * t_D);
                    let pos = createVector(pX, pY, pZ);
                    v[r].push(pos);
                }
            }

            for (let r = 0; r < v.length; r++) {
                fill(340, 100, -20 + r * r_D * 120);
                for (let theta = 0; theta < v[r].length; theta++) {
                    if (r < v.length - 1 && theta < v[r].length - 1) {
                        beginShape();
                        vertex(v[r][theta].x, v[r][theta].y, v[r][theta].z);
                        vertex(v[r + 1][theta].x, v[r + 1][theta].y, v[r + 1][theta].z);
                        vertex(v[r + 1][theta + 1].x, v[r + 1][theta + 1].y, v[r + 1][theta + 1].z);
                        vertex(v[r][theta + 1].x, v[r][theta + 1].y, v[r][theta + 1].z);
                        endShape(CLOSE);
                    }
                }
            }

            v = [];
        }

        function windowResized() {
            resizeCanvas(windowWidth, windowHeight);
        }
    </script>
</body>
</html>